var init=function(){var q={title:"リンクラ プレイレポート結合",explanation1:"リンクラのプレイレポート画像2枚を結合します。<br/>例：",explanation2:"画像ファイルはどこにもアップロードされません。ファイルの結合はご使用の端末上で実行されます。",explanation3:"処理時間は端末の性能や使用状況により異なります。解像度の高い端末のスクリーンショットは画像サイズが大きくなるため、処理に時間がかかる場合があります。また、バッテリー消費も大きくなります。",explanation4:"スクリーンショット1にはカード部分の最上部が、スクリーンショット2にはカード部分の最下部が表示されている画像をそれぞれ指定してください。逆に指定すると正しく結合されません。",explanation5:"編集していないスクリーンショットを使用してください。トリミング等の編集を行った画像では正しく処理できない場合があります。",explanation6:"「LIVE CLEAR!」と表示され、背景やスコアが完全に表示された後でプレイレポートを表示し、両方のスクリーンショットを撮ってください。背景が異なると差分を正しく抽出できません。",explanation7:"免責事項：いかなる場合も、本ツールの利用に起因もしくは関連して発生した間接的、偶発的、結果的損害に対して一切の責任と義務を負いません。",screenshotButtonLabel1:"スクリーンショット 1：",screenshotButtonLabel2:"スクリーンショット 2：",selectFile:"ファイルを選択",reset:"リセット",merge:"結合",screenshotPlaceholderDescription:"選択したスクリーンショットと、抽出したプレイレポート部分がここに表示されます。",screenshotPlaceholderDescription2:"結合ボタンを押すと、プレイレポートを結合した画像が原寸大で最下部に表示されます。",screenshot:"スクリーンショット",playReport:"プレイレポート",mergedImage:"結合後の画像",needTwoImages:"2枚のスクリーンショットを指定してください。",differentSize:"抽出した2枚のプレイレポートのサイズが異なるため結合できません。",checkImage:"差分確認中...",fileTypeNotAllowed:"png、jpgまたはjpegファイルを指定してください。",tooDifferent:"2枚のスクリーンショットが大きく異なるため結合できません。",extract1stReport:"1枚目のカード部分を抽出中...",findMostMatch:"最大一致箇所を抽出中...",extract2ndReport:"2枚目のカード部分を結合中...",createMergedImage:"結合した画像を作成中...",saveImage:"画像を保存",close:"閉じる",cancel:"キャンセル"};var A=q;document.title=A.title;document.getElementById("explanation1").innerHTML=A.explanation1;document.getElementById("explanation2").textContent=A.explanation2;document.getElementById("explanation3").textContent=A.explanation3;document.getElementById("explanation4").textContent=A.explanation4;document.getElementById("explanation5").textContent=A.explanation5;document.getElementById("explanation6").textContent=A.explanation6;document.getElementById("explanation7").textContent=A.explanation7;document.getElementById("inputLabel1").textContent=A.screenshotButtonLabel1;document.getElementById("inputButton1").textContent=A.selectFile;document.getElementById("inputLabel2").textContent=A.screenshotButtonLabel2;document.getElementById("inputButton2").textContent=A.selectFile;document.getElementById("resetButton").textContent=A.reset;document.getElementById("mergeButton").textContent=A.merge;document.getElementById("screenshotPlaceholderDescription").textContent=A.screenshotPlaceholderDescription;document.getElementById("screenshotPlaceholderDescription2").textContent=A.screenshotPlaceholderDescription2;document.getElementById("mergeButton").textContent=A.merge;document.getElementById("screenshotLabel").textContent=A.screenshot;document.getElementById("playReportLabel").textContent=A.playReport;document.getElementById("mergedImageLabel").textContent=A.mergedImage;document.getElementById("saveButton").textContent=A.saveImage;var u=document.getElementById("inputFile1");var s=document.getElementById("inputFile2");var w=document.getElementById("screenshotPlaceholder");var y=document.getElementById("screenshotLabel");var m=document.getElementById("image1");var l=document.getElementById("image2");var x={divImage1:m,divImage2:l};var C=document.getElementById("playReportLabel");var O=document.getElementById("playReport1");var N=document.getElementById("playReport2");var v={divPlayReport1:O,divPlayReport2:N};var g=document.getElementById("merged");var d={image1:null,image2:null};var k=function(){d.image1=new Image();d.image2=new Image()};k();var B={uploadedImage1:null,uploadedImage2:null,playReport1:null,playReport2:null,uploadedImageThumbnail1:null,uploadedImageThumbnail2:null,playReportThumbnail1:null,playReportThumbnail2:null,mergedImage:null};var E=function(){B.uploadedImageThumbnail1=document.createElement("canvas");B.uploadedImageThumbnail1.width=0;B.uploadedImageThumbnail1.height=0;if(m.firstChild){m.removeChild(m.firstChild)}m.appendChild(B.uploadedImageThumbnail1);B.uploadedImageThumbnail2=document.createElement("canvas");B.uploadedImageThumbnail2.width=0;B.uploadedImageThumbnail2.height=0;if(l.firstChild){l.removeChild(l.firstChild)}l.appendChild(B.uploadedImageThumbnail2);B.playReportThumbnail1=document.createElement("canvas");B.playReportThumbnail1.width=0;B.playReportThumbnail1.height=0;if(O.firstChild){O.removeChild(O.firstChild)}O.appendChild(B.playReportThumbnail1);B.playReportThumbnail2=document.createElement("canvas");B.playReportThumbnail2.width=0;B.playReportThumbnail2.height=0;if(N.firstChild){N.removeChild(N.firstChild)}N.appendChild(B.playReportThumbnail2);n();B.uploadedImage1=document.createElement("canvas");B.uploadedImage2=document.createElement("canvas");B.playReport1=document.createElement("canvas");B.playReport2=document.createElement("canvas")};var n=function(){B.mergedImage=document.createElement("canvas");B.mergedImage.width=0;B.mergedImage.height=0;if(g.lastElementChild.nodeName.toLowerCase()==="canvas"){g.removeChild(g.lastElementChild)}g.appendChild(B.mergedImage)};E();var H=1/5;var F=document.getElementById("warning");var j=document.getElementById("warningMessage");var z=document.getElementById("WarningButton");var f=false;var M=document.getElementById("inputButton1");M.onclick=function(){document.getElementById("inputFile1").click()};var K=document.getElementById("inputButton2");K.onclick=function(){document.getElementById("inputFile2").click()};var t=document.getElementById("saveButton");var I=function(){var R=document.createElement("a");R.href=B.mergedImage.toDataURL("image/png");var Q={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};var P=new Date().toLocaleDateString("ja-JP",Q).replaceAll("/","").replaceAll(":","").replaceAll(" ","-");R.download="image-"+P+".png";R.click()};t.addEventListener("click",I);var p=function(P){var R="";try{R=P.value.split(".").pop()}catch(Q){}return R};var o=function(Q,T,S){var U=p(S&&S.srcElement);if(U!=="png"&&U!=="jpg"&&U!=="jpeg"){h(A.fileTypeNotAllowed);return}T.divWarning.style.display="none";var R=S.target.files;var P=new FileReader();P.readAsDataURL(R[0]);P.onload=function(){var W=P.result;var V=T.images["image"+Q];V.src=W;V.onload=function(){var Z=this;T.divWarning.style.display="none";T.screenshotLabel.style.display="";var X=T.canvases["uploadedImage"+Q];X.width=Z.width;X.height=Z.height;X.getContext("2d",{willReadFrequently:true}).drawImage(Z,0,0,Z.width,Z.height);c(X,T.canvases["uploadedImageThumbnail"+Q],T.divImages["divImage"+Q]);var Y=T.canvases["playReport"+Q];J(X,Y);c(Y,T.canvases["playReportThumbnail"+Q],T.playReportDivElements["divPlayReport"+Q]);T.pPlayReport.style.display="";T.divScreenshotPlaceholder.style.display="none";T.divWarning.style.display="none"}}};var c=function(S,U,Q){var T=new Image();var R=S.width*H;var P=S.height*H;T.onload=function(){Q.style.display="";U.width=R;U.height=P;var V=U.getContext("2d",{willReadFrequently:true});V.scale(H,H);V.drawImage(T,0,0)};T.src=S.toDataURL()};var J=function(R,ad){var P=R.getContext("2d",{willReadFrequently:true}).getImageData(0,0,R.width,R.height);var ac=document.createElement("canvas");var ab=ac.getContext("2d",{willReadFrequently:true}).createImageData(R.width,R.height);var X=90;var S=0.8;var aa=P.data;var Q=ab.data;var W=0;for(var V=0;V<aa.length;){var Z=0;for(var U=0;U<R.width*4;U+=4){if(aa[V+U]<X&&aa[V+U+1]<X&&aa[V+U+2]<X){Z++}}if((Z/R.width)>S){V+=R.width*4;continue}for(var T=0;T<R.width*4;T+=4){Q[W++]=aa[V++]}}var Y=W/(R.width*4);var ae=R.getContext("2d",{willReadFrequently:true}).createImageData(R.width,Y);for(var V=0;V<W;V++){ae.data[V]=Q[V]}ad.width=R.width;ad.height=Y;ad.getContext("2d",{willReadFrequently:true}).putImageData(ae,0,0)};var G={images:d,canvases:B,screenshotLabel:y,divImages:x,pPlayReport:C,divScreenshotPlaceholder:w,playReportDivElements:v,divWarning:F};u.addEventListener("change",o.bind(this,"1",G),false);s.addEventListener("change",o.bind(this,"2",G),false);var D=document.getElementById("resetButton");var r=function(){u.value="";s.value="";k();E();y.style.display="none";m.style.display="none";C.style.display="none";O.style.display="none";N.style.display="none";w.style.display="";g.style.display="none";F.style.display="none";j.textContent="";z.style.display="none"};D.onclick=r;var i=document.getElementById("mergeButton");var b=function(){if(O.style.display==="none"||N.style.display==="none"){h(A.needTwoImages);return}g.style.display="none";n();var ac=B.playReport1;var ab=B.playReport2;var T=ac.getContext("2d",{willReadFrequently:true}).getImageData(0,0,ac.width,ac.height);var S=ab.getContext("2d",{willReadFrequently:true}).getImageData(0,0,ab.width,ab.height);if(T.width!==S.width||T.height!==S.height){h(A.differentSize);return}var Z=T.data;var X=S.data;var R=document.createElement("canvas");var au=R.getContext("2d",{willReadFrequently:true}).createImageData(ac.width*2,ac.height*2);var ar=au.data;var aa=p(u);var aq=(aa==="jpg"||aa==="jpeg");var af=10;var ag=0.6;h(A.checkImage,A.cancel,a);f=true;var ae=0;for(var ai=0;ai<Z.length&&ai<X.length&&f;){var Y=0;for(var ah=0;ah<ac.width*4;ah+=4){var W=ai+ah;if((W+3)>Z.length||(W+3)>X.length){break}if(aq&&Math.abs(Z[W]-X[W])>af&&Math.abs(Z[W+1]-X[W+1])>af&&Math.abs(Z[W+2]-X[W+2]>af)){Y++}else{if(!aq&&(Z[W]!==X[W]||Z[W+1]!==X[W+1]||Z[W+2]!==X[W+2])){Y++}}}ai+=(ac.width*4);if(Y>0){ae++}}if((ae/ac.height)>ag){h(A.tooDifferent);return}L(A.extract1stReport);var al=0;var ao=0;var Q=0;var aj=(ac.width*4)*(parseInt((ac.height*0.8),10));while(ao<aj&&f){ar[al++]=Z[ao++]}ao-=(ac.width*4);Q=(ab.width*4)*parseInt((ab.height*0.5),10);var V=false;var at=0;var ak=0;L(A.findMostMatch);for(var ai=Q;ai<X.length&&!V&&f;ai+=(ab.width*4)){var Y=0;for(var ah=0;ah<ac.width*4;ah+=4){var an=ao+ah;var am=ai+ah;if((an+3)>Z.length||(am+3)>X.length){V=true;break}if(aq&&Math.abs(Z[an]-X[am])<af&&Math.abs(Z[an+1]-X[am+1])<af&&Math.abs(Z[an+2]-X[am+2]<af)){Y++}else{if(!aq&&Z[an]===X[am]&&Z[an+1]===X[am+1]&&Z[an+2]===X[am+2]){Y++}}}var ap=Y/ab.width;if(ap>at){at=ap;ak=ai}}Q=ak;L(A.extract2ndReport);for(;Q<X.length&&f;){ar[al++]=X[Q++]}f=false;L(A.createMergedImage);var P=al/(ac.width*4);var U=B.mergedImage;var ad=U.getContext("2d",{willReadFrequently:true}).createImageData(ac.width,P);for(var ai=0;ai<al;ai++){ad.data[ai]=ar[ai]}g.style.display="";U.width=ac.width;U.height=P;U.getContext("2d",{willReadFrequently:true}).putImageData(ad,0,0);e()};i.onclick=b;var h=function(P,Q,R){j.textContent=P;if(Q&&R){z.textContent=Q;z.onclick=R;z.style.display=""}else{z.style.display="none"}F.style.display="block"};var e=function(){j.textContent="";z.textContent="";F.style.display="none";z.style.display="none"};var a=function(){f=false;e()};var L=function(P){j.textContent=P}};init();