var init=function(){var t={title:"リンクラ プレイレポート結合",explanation1:"リンクラのプレイレポート画像2枚を結合します。<br/>例：",explanation2:"画像ファイルはどこにもアップロードされません。ファイルの結合はご使用の端末上で実行されます。",explanation3:"処理時間は端末の性能や使用状況により異なります。解像度の高い端末のスクリーンショットは画像サイズが大きくなるため、処理に時間がかかる場合があります。また、バッテリー消費も大きくなります。",explanation4:"スクリーンショット1にはカード部分の最上部が、スクリーンショット2にはカード部分の最下部が表示されている画像をそれぞれ指定してください。逆に指定すると正しく結合されません。",explanation5:"「LIVE CLEAR!」と表示され、背景やスコアが完全に表示された後でプレイレポートを表示し、両方のスクリーンショットを撮ってください。背景が異なると差分を正しく抽出できません。",explanation6:"免責事項：いかなる場合も、本ツールの利用に起因もしくは関連して発生した間接的、偶発的、結果的損害に対して一切の責任と義務を負いません。",screenshotButtonLabel1:"スクリーンショット 1：",screenshotButtonLabel2:"スクリーンショット 2：",selectFile:"ファイルを選択",reset:"リセット",merge:"結合",screenshotPlaceholderDescription:"選択したスクリーンショットと、抽出したプレイレポート部分がここに表示されます。",screenshotPlaceholderDescription2:"結合ボタンを押すと、プレイレポートを結合した画像が原寸大で最下部に表示されます。",screenshot:"スクリーンショット",playReport:"プレイレポート",mergedImage:"結合後の画像",needTwoImages:"2枚のスクリーンショットを指定してください。",differentSize:"抽出した2枚のプレイレポートのサイズが異なるため結合できません。",checkImage:"差分確認中...",fileTypeNotAllowed:"png、jpgまたはjpegファイルを指定してください。",tooDifferent:"2枚のスクリーンショットが大きく異なるため結合できません。",extract1stReport:"1枚目のカード部分を抽出中...",findMostMatch:"最大一致箇所を抽出中...",extract2ndReport:"2枚目のカード部分を結合中...",createMergedImage:"結合した画像を作成中...",saveImage:"画像を保存",close:"閉じる",cancel:"キャンセル"};var D=t;document.title=D.title;document.getElementById("explanation1").innerHTML=D.explanation1;document.getElementById("explanation2").textContent=D.explanation2;document.getElementById("explanation3").textContent=D.explanation3;document.getElementById("explanation4").textContent=D.explanation4;document.getElementById("explanation5").textContent=D.explanation5;document.getElementById("explanation6").textContent=D.explanation6;document.getElementById("inputLabel1").textContent=D.screenshotButtonLabel1;document.getElementById("inputButton1").textContent=D.selectFile;document.getElementById("inputLabel2").textContent=D.screenshotButtonLabel2;document.getElementById("inputButton2").textContent=D.selectFile;document.getElementById("resetButton").textContent=D.reset;document.getElementById("mergeButton").textContent=D.merge;document.getElementById("screenshotPlaceholderDescription").textContent=D.screenshotPlaceholderDescription;document.getElementById("screenshotPlaceholderDescription2").textContent=D.screenshotPlaceholderDescription2;document.getElementById("mergeButton").textContent=D.merge;document.getElementById("screenshotLabel").textContent=D.screenshot;document.getElementById("playReportLabel").textContent=D.playReport;document.getElementById("mergedImageLabel").textContent=D.mergedImage;document.getElementById("saveButton").textContent=D.saveImage;var x=document.getElementById("inputFile1");var v=document.getElementById("inputFile2");var z=document.getElementById("screenshotPlaceholder");var B=document.getElementById("screenshotLabel");var p=document.getElementById("image1");var o=document.getElementById("image2");var A={divImage1:p,divImage2:o};var F=document.getElementById("playReportLabel");var R=document.getElementById("playReport1");var Q=document.getElementById("playReport2");var y={divPlayReport1:R,divPlayReport2:Q};var g=document.getElementById("merged");var d={image1:null,image2:null};var n=function(){d.image1=new Image();d.image2=new Image()};n();var E={uploadedImage1:null,uploadedImage2:null,playReport1:null,playReport2:null,uploadedImageThumbnail1:null,uploadedImageThumbnail2:null,playReportThumbnail1:null,playReportThumbnail2:null,mergedImage:null};var H=function(){E.uploadedImageThumbnail1=document.createElement("canvas");E.uploadedImageThumbnail1.width=0;E.uploadedImageThumbnail1.height=0;if(p.firstChild){p.removeChild(p.firstChild)}p.appendChild(E.uploadedImageThumbnail1);E.uploadedImageThumbnail2=document.createElement("canvas");E.uploadedImageThumbnail2.width=0;E.uploadedImageThumbnail2.height=0;if(o.firstChild){o.removeChild(o.firstChild)}o.appendChild(E.uploadedImageThumbnail2);E.playReportThumbnail1=document.createElement("canvas");E.playReportThumbnail1.width=0;E.playReportThumbnail1.height=0;if(R.firstChild){R.removeChild(R.firstChild)}R.appendChild(E.playReportThumbnail1);E.playReportThumbnail2=document.createElement("canvas");E.playReportThumbnail2.width=0;E.playReportThumbnail2.height=0;if(Q.firstChild){Q.removeChild(Q.firstChild)}Q.appendChild(E.playReportThumbnail2);q();E.uploadedImage1=document.createElement("canvas");E.uploadedImage2=document.createElement("canvas");E.playReport1=document.createElement("canvas");E.playReport2=document.createElement("canvas")};var q=function(){E.mergedImage=document.createElement("canvas");E.mergedImage.width=0;E.mergedImage.height=0;if(g.lastElementChild.nodeName.toLowerCase()==="canvas"){g.removeChild(g.lastElementChild)}g.appendChild(E.mergedImage)};H();var K=1/5;var I=document.getElementById("warning");var m=document.getElementById("warningMessage");var C=document.getElementById("WarningButton");var f=false;var P=document.getElementById("inputButton1");P.onclick=function(){document.getElementById("inputFile1").click()};var N=document.getElementById("inputButton2");N.onclick=function(){document.getElementById("inputFile2").click()};var w=document.getElementById("saveButton");var L=function(){var U=document.createElement("a");U.href=E.mergedImage.toDataURL("image/png");var T={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};var S=new Date().toLocaleDateString("ja-JP",T).replaceAll("/","").replaceAll(":","").replaceAll(" ","-");U.download="image-"+S+".png";U.click()};w.addEventListener("click",L);var s=function(S){var U="";try{U=S.value.split(".").pop()}catch(T){}return U};var r=function(T,W,V){var X=s(V&&V.srcElement);if(X!=="png"&&X!=="jpg"&&X!=="jpeg"){h(D.fileTypeNotAllowed);return}W.divWarning.style.display="none";var U=V.target.files;var S=new FileReader();S.readAsDataURL(U[0]);S.onload=function(){var Z=S.result;var Y=W.images["image"+T];Y.src=Z;Y.onload=function(){var ac=this;W.divWarning.style.display="none";W.screenshotLabel.style.display="";var aa=W.canvases["uploadedImage"+T];aa.width=ac.width;aa.height=ac.height;aa.getContext("2d",{willReadFrequently:true}).drawImage(ac,0,0,ac.width,ac.height);c(aa,W.canvases["uploadedImageThumbnail"+T],W.divImages["divImage"+T]);var ab=W.canvases["playReport"+T];M(aa,ab);c(ab,W.canvases["playReportThumbnail"+T],W.playReportDivElements["divPlayReport"+T]);W.pPlayReport.style.display="";W.divScreenshotPlaceholder.style.display="none";W.divWarning.style.display="none"}}};var c=function(V,X,T){var W=new Image();var U=V.width*K;var S=V.height*K;W.onload=function(){T.style.display="";X.width=U;X.height=S;var Y=X.getContext("2d",{willReadFrequently:true});Y.scale(K,K);Y.drawImage(W,0,0)};W.src=V.toDataURL()};var M=function(U,ad){var S=U.getContext("2d",{willReadFrequently:true}).getImageData(0,0,U.width,U.height);var ac=document.createElement("canvas");var ab=ac.getContext("2d",{willReadFrequently:true}).createImageData(U.width,U.height);var X=90;var V=0.8;var aa=S.data;var T=ab.data;var W=0;for(let i=0;i<aa.length;){var Z=0;for(let j=0;j<U.width*4;j+=4){if(aa[i+j]<X&&aa[i+j+1]<X&&aa[i+j+2]<X){Z++}}if((Z/U.width)>V){i+=U.width*4;continue}for(let k=0;k<U.width*4;k+=4){T[W++]=aa[i++]}}var Y=W/(U.width*4);var ae=U.getContext("2d",{willReadFrequently:true}).createImageData(U.width,Y);for(let i=0;i<W;i++){ae.data[i]=T[i]}ad.width=U.width;ad.height=Y;ad.getContext("2d",{willReadFrequently:true}).putImageData(ae,0,0)};var J={images:d,canvases:E,screenshotLabel:B,divImages:A,pPlayReport:F,divScreenshotPlaceholder:z,playReportDivElements:y,divWarning:I};x.addEventListener("change",r.bind(this,"1",J),false);v.addEventListener("change",r.bind(this,"2",J),false);var G=document.getElementById("resetButton");var u=function(){x.value="";v.value="";n();H();B.style.display="none";p.style.display="none";F.style.display="none";R.style.display="none";Q.style.display="none";z.style.display="";g.style.display="none";I.style.display="none";m.textContent="";C.style.display="none"};G.onclick=u;var l=document.getElementById("mergeButton");var b=function(){if(R.style.display==="none"||Q.style.display==="none"){h(D.needTwoImages);return}g.style.display="none";q();var af=E.playReport1;var ae=E.playReport2;var W=af.getContext("2d",{willReadFrequently:true}).getImageData(0,0,af.width,af.height);var V=ae.getContext("2d",{willReadFrequently:true}).getImageData(0,0,ae.width,ae.height);if(W.width!==V.width||W.height!==V.height){h(D.differentSize);return}var ac=W.data;var aa=V.data;var U=document.createElement("canvas");var av=U.getContext("2d",{willReadFrequently:true}).createImageData(af.width*2,af.height*2);var at=av.data;var aj=0.5;h(D.checkImage,D.cancel,a);f=true;var ah=0;for(let i=0;i<ac.length&&i<aa.length&&f;){var ab=0;for(let j=0;j<af.width*4;j+=4){var Z=i+j;if((Z+3)>ac.length||(Z+3)>aa.length){break}if(ac[Z]!==aa[Z]||ac[Z+1]!==aa[Z+1]||ac[Z+2]!==aa[Z+2]){ab++}i+=4}if(ab>0){ah++}}if((ah/af.height)>aj){h(D.tooDifferent);return}O(D.extract1stReport);var am=0;var ap=0;var T=0;var ak=(af.width*4)*(parseInt((af.height*0.8),10));while(ap<ak&&f){at[am++]=ac[ap++]}ap-=(af.width*4);T=(ae.width*4)*parseInt((ae.height*0.5),10);var ad=s(x);var ar=(ad==="jpg"||ad==="jpeg");var ai=10;var Y=false;var au=0;var al=0;O(D.findMostMatch);for(let i=T;i<aa.length&&!Y&&f;i+=(ae.width*4)){var ab=0;for(let j=0;j<af.width*4;j+=4){var ao=ap+j;var an=i+j;if((ao+3)>ac.length||(an+3)>aa.length){Y=true;break}if(ar&&Math.abs(ac[ao]-aa[an])<ai&&Math.abs(ac[ao+1]-aa[an+1])<ai&&Math.abs(ac[ao+2]-aa[an+2]<ai)){ab++}else{if(!ar&&ac[ao]===aa[an]&&ac[ao+1]===aa[an+1]&&ac[ao+2]===aa[an+2]){ab++}}}var aq=ab/ae.width;if(aq>au){au=aq;al=i}}T=al;O(D.extract2ndReport);for(;T<aa.length&&f;){at[am++]=aa[T++]}f=false;O(D.createMergedImage);var S=am/(af.width*4);var X=E.mergedImage;var ag=X.getContext("2d",{willReadFrequently:true}).createImageData(af.width,S);for(let i=0;i<am;i++){ag.data[i]=at[i]}g.style.display="";X.width=af.width;X.height=S;X.getContext("2d",{willReadFrequently:true}).putImageData(ag,0,0);e()};l.onclick=b;var h=function(S,T,U){m.textContent=S;if(T&&U){C.textContent=T;C.onclick=U;C.style.display=""}else{C.style.display="none"}I.style.display="block"};var e=function(){m.textContent="";C.textContent="";I.style.display="none";C.style.display="none"};var a=function(){f=false;e()};var O=function(S){m.textContent=S}};init();